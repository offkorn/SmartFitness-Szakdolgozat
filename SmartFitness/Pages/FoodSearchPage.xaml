<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             BackgroundColor="#F6FAFD"
             x:Class="SmartFitness.Pages.FoodSearchPage"
             Shell.NavBarIsVisible="False">

     <Grid RowDefinitions="Auto, *">

        <VerticalStackLayout Grid.Row="0" Padding="0,10" Spacing="0">
            
       
        <!-- tab bar, - back button and page title -->
        <HorizontalStackLayout Spacing="0" Margin="0,0,0,0">

            <ImageButton Source="back_icon" Scale="0.35" Rotation="180" HorizontalOptions="Start" Clicked="OnBackClicked" VerticalOptions="Center"></ImageButton>

            <Label 
               Text="Search Recipes"
               FontSize="Medium"
               FontAttributes="Bold"
                VerticalTextAlignment="Center" HorizontalOptions="Center"/>
        </HorizontalStackLayout>

        <!-- Search -->
        <Frame BackgroundColor="#F6FAFD"
               BorderColor="#E2E2E2"
               HorizontalOptions="FillAndExpand"
               CornerRadius="15"
               Padding="0,0" 
               MinimumHeightRequest="50"
               Margin="20,20,20,20" 
               HasShadow="True">
            <Frame.Shadow>
                <Shadow Brush="#E8EBEE" Offset="1,4" Radius="0"/>
            </Frame.Shadow>

            <Grid ColumnDefinitions="*, Auto">
                <Entry x:Name="SearchEntry"
                   Placeholder="Type in"
                   PlaceholderColor="Gray"
                   TextColor="Black"
                   VerticalOptions="Center"
                   Margin="15,0,0,0"
                   FontSize="Body"
                   ReturnCommand="{Binding SearchCommand}"
                   TextChanged="OnTextChanged"/>


                <Image Margin="0,0,20,0"
                       HorizontalOptions="End"
                       VerticalOptions="Center"
                       Source="search_icon.png" 
                       Scale="0.7"/>
                
                    <Button Grid.Column="1" 
                                 Text="x" 
                            BackgroundColor="Transparent"
                                 HeightRequest="20" 
                                 WidthRequest="20" 
                                 Margin="0,0,10,0"
                                 Clicked="OnClearSearchClicked"
                                 IsVisible="False"
                                 x:Name="ClearButton"/>

                </Grid>
        </Frame>

        </VerticalStackLayout>



        <CollectionView Grid.Row="1" 
                        x:Name="ResultsCollectionView" 
                        Margin="0,10,0,20"
                        RemainingItemsThreshold="5"
                        RemainingItemsThresholdReached="OnLoadMoreItems">   

            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="10">
                    <Label Text="Start typing to search" 
                           TextColor="Gray" 
                           FontSize="Body"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border StrokeShape="RoundRectangle 15"
                            StrokeThickness="0"
                            BackgroundColor="White"
                            Margin="15,6"
                            Padding="10">

                        

                        <Border.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnResultTapped" />
                        </Border.GestureRecognizers>

                        <Grid ColumnDefinitions="80, *">
                            <Image Grid.Column="0" 
                                   Source="{Binding ImageUrl}" 
                                   Aspect="AspectFill" 
                                   HeightRequest="70" 
                                   WidthRequest="70" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center">
                                <Image.Clip>
                                    <EllipseGeometry Center="35,35" RadiusX="35" RadiusY="35"/>
                                </Image.Clip>
                            </Image>

                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="4" Margin="10,0,0,0">

                                <Label Text="{Binding Title}" 
                                       FontAttributes="Bold" 
                                       FontSize="Medium" 
                                       TextColor="Black" 
                                       LineBreakMode="TailTruncation"/>

                                <HorizontalStackLayout Spacing="10">
                                    <Label Text="{Binding Calories, StringFormat='{0} kcal'}" 
                                           TextColor="#859700" 
                                           FontSize="Small"/>

                                    <Label Text="â€¢" 
                                           TextColor="Gray" 
                                           FontSize="Small"/>

                                    <Label Text="{Binding CookingTime, StringFormat='{0} min'}" 
                                           TextColor="Gray" 
                                           FontSize="Small"/>
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>