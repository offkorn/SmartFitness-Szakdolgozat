<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SmartFitness.Pages.RecipeDetailPage"  
             xmlns:converters="clr-namespace:SmartFitness.Converters" 
             BackgroundColor="#F6FAFD"
             Shell.NavBarIsVisible="False">


    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:RecipeImageConverter x:Key="RecipeImageConverter" />
            <converters:RecipeImageScaleConverter x:Key="RecipeImageScaleConverter" />
            <converters:NullToDefaultImageConverter x:Key="NullToDefaultImageConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView VerticalScrollBarVisibility="Never"> 
        <VerticalStackLayout Spacing="0" Padding="0,10" VerticalOptions="FillAndExpand">


            <!-- tab bar, - back button and page title -->
            <Grid Grid.Row="0" Margin="0,0,0,10" Padding="5,0">

                <ImageButton Source="back_icon" Scale="0.35" Rotation="180" HorizontalOptions="Start" Clicked="OnBackButton" VerticalOptions="Center"></ImageButton>

                <Label 
                   Text="Recipe Details"
                   FontSize="Medium"
                   FontAttributes="Bold"
                    VerticalTextAlignment="Center" HorizontalOptions="Center"/>

                <ImageButton x:Name="SaveButton" Source="bookmark_unfilled_icon.svg" Scale="0.5"  HorizontalOptions="End" Clicked="OnSaveClicked" VerticalOptions="Center"></ImageButton>

            </Grid>



            <!-- Image Placeholder -->

            <Grid HeightRequest="250" Margin="0,0,0,0">

                <BoxView Color="#ffffff" />

                <Image Source="{Binding ImageUrl, Converter={StaticResource RecipeImageConverter}}" 
                       Scale="{Binding ImageUrl, Converter={StaticResource RecipeImageScaleConverter}}"
                       Aspect="AspectFill"
                       IsVisible="True">
                </Image>

            </Grid>


            <!-- Type, Title, Cooking Time -->
            <Frame BackgroundColor="White"
                   HasShadow="True"
                   BorderColor="Transparent"
                   HorizontalOptions="FillAndExpand"
                   MinimumHeightRequest="100">
                <VerticalStackLayout Margin="20,10,0,10" Spacing="10">
                    <Frame BorderColor="Transparent" BackgroundColor="Black" VerticalOptions="Start" HorizontalOptions="Start" Padding="10">
                        <Label Text="{Binding Type}"
                           FontSize="Micro"
                           FontFamily=""
                               FontAttributes="Bold"
                           TextColor="White"/>
                    </Frame>
                    
                    
                    <Label Text="{Binding Title}"
                           FontAttributes="Bold"
                           FontSize="Medium"
                           FontAutoScalingEnabled="True"
                           Margin="0,10,0,0"/>
                    <Label Text="{Binding CookingTime, StringFormat='Cooking Time: {0} minutes'}"
                           FontSize="Small"
                           TextColor="#4A6375"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Author -->
            <Frame BackgroundColor="White"
                   HasShadow="True"
                   BorderColor="Transparent"
                   HorizontalOptions="FillAndExpand"
                   MinimumHeightRequest="100"
                   Margin="0,10,0,0">
                <HorizontalStackLayout Margin="20,10" Spacing="20">
                    <Frame CornerRadius="35"
                           WidthRequest="60"
                           HeightRequest="60"
                           BorderColor="Transparent"
                           BackgroundColor="Black">
                        
                        <VerticalStackLayout Padding="0" VerticalOptions="Start" Spacing="0">
                            <Label TextColor="White"
                               FontSize="Medium"
                               HorizontalTextAlignment="Center"
                                   Margin="0,-7,0,0"
                                   Padding="0"
                               VerticalTextAlignment="Start">o</Label>
                            <Label TextColor="White"
                                   FontSize="Large"
                                   Margin="0,-11,0,0"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="End">O</Label>
                        </VerticalStackLayout>
                        
                    </Frame>
                    <VerticalStackLayout Spacing="5" Margin="0,5,0,0">
                        <Label x:Name="AuthorLabel"
                               FontAttributes="Bold"
                               FontSize="Medium"/>
                        <Label FontSize="Small">Submitted</Label>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
            </Frame>

            <!-- Nutrition -->
            <Frame BackgroundColor="White"
                   HasShadow="True"
                   BorderColor="Transparent"
                   HorizontalOptions="FillAndExpand"
                   MinimumHeightRequest="100"
                   Margin="0,10,0,0">
                <VerticalStackLayout Margin="20,10" Spacing="10">
                    <Label FontAttributes="Bold" FontSize="Subtitle" FontFamily="" Margin="0,0,0,20">NUTRITION</Label>
                    <Grid ColumnDefinitions="auto,auto,auto,auto" ColumnSpacing="20" RowDefinitions="*,*" RowSpacing="10">
                        <Label Grid.Column="0" Grid.Row="0" Text="Calories" TextColor="Gray" FontSize="Small"/>
                        <Label Grid.Column="1" Grid.Row="0" Text="Protein" TextColor="Gray" FontSize="Small"/>
                        <Label Grid.Column="2" Grid.Row="0" Text="Carbs" TextColor="Gray" FontSize="Small"/>
                        <Label Grid.Column="3" Grid.Row="0" Text="Fat" TextColor="Gray" FontSize="Small"/>
                        <Label Grid.Column="0" Grid.Row="1" Text="{Binding Calories, StringFormat='{0} kcal'}" FontAttributes="Bold" FontSize="Small"/>
                        <Label Grid.Column="1" Grid.Row="1" Text="{Binding Protein, StringFormat='{0} g'}" FontAttributes="Bold" FontSize="Small"/>
                        <Label Grid.Column="2" Grid.Row="1" Text="{Binding Carbs, StringFormat='{0} g'}" FontAttributes="Bold" FontSize="Small"/>
                        <Label Grid.Column="3" Grid.Row="1" Text="{Binding Fat, StringFormat='{0} g'}" FontAttributes="Bold" FontSize="Small"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Ingredients -->
            <Frame BackgroundColor="White"
                   HasShadow="True"
                   BorderColor="Transparent"
                   HorizontalOptions="FillAndExpand"
                   MinimumHeightRequest="100"
                   Margin="0,10,0,0">
                <VerticalStackLayout Margin="20,10" Spacing="10">
                    <Label FontAttributes="Bold" FontSize="Subtitle" FontFamily="" Margin="0,0,0,10">INGREDIENTS</Label>
                    <VerticalStackLayout Spacing="5" BindableLayout.ItemsSource="{Binding Ingredients}">
                        <BindableLayout.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding ., StringFormat='â€¢  {0}'}" FontSize="Medium" Margin="10,0" />
                            </DataTemplate>
                        </BindableLayout.ItemTemplate>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Directions -->
            <Frame BackgroundColor="White"
                   HasShadow="True"
                   BorderColor="Transparent"
                   HorizontalOptions="FillAndExpand"
                   MinimumHeightRequest="150"
                   Margin="0,10,0,0">
                <VerticalStackLayout Margin="20,10" Spacing="10">
                    <Label FontAttributes="Bold" FontSize="Subtitle" FontFamily="" Margin="0,0,0,10">DIRECTIONS</Label>
                    <Label Text="{Binding Directions}" FontSize="Small" TextColor="Black"/>
                </VerticalStackLayout>
            </Frame>
            
            
            

            <!-- Tutorial -->
            <Frame BackgroundColor="White"
                   HasShadow="True"
                   BorderColor="Transparent"
                   HorizontalOptions="FillAndExpand"
                   MinimumHeightRequest="150"
                   Margin="0,10,0,0">
                <VerticalStackLayout Margin="20,10" Spacing="10">
                    <Label FontAttributes="Bold" 
                           FontSize="Subtitle" 
                           Margin="0,0,0,10" 
                           Text="TUTORIAL" />

                    <Label x:Name="TutorialLinkLabel"
                           FontSize="Small" 
                           TextColor="#18A0FB"
                           TextDecorations="Underline"
                           Text="{Binding TutorialUrl}">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnURLClicked" />
                        </Label.GestureRecognizers>
                    </Label>
                </VerticalStackLayout>
            </Frame>

            
            
            

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>